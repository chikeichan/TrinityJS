!function(){"use strict";function t(t){var e=new XMLHttpRequest,n=d();t.encode&&(t.url+=encodeURI(t.encode(t.payload))),e.open(t.type.toUpperCase(),t.url),e.setRequestHeader("Content-Type",t.contentType);for(var r in t.headers)e.setRequestHeader(r,t.headers[r]);return e.onload=function(){e.status>=200&&e.status<=299?n.resolve(e.responseText):n.reject(e.responseText)},t.encode?e.send():e.send(JSON.stringify(t.payload)),n.promise}function e(t,e){e=e||{};for(var n in e)t[n]||(t[n]=e[n]);return t}function n(t){var e=this._constructor;if(e){var n={},r=function(){for(var t in n)this[t]=n[t];e.apply(this,arguments)},i={};for(var o in e.prototype)Object.prototype.hasOwnProperty.call(e.prototype,o)&&(i[o]=e.prototype[o]);for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){var a=t[s];"function"==typeof a?i[s]=t[s]:n[s]=t[s]}return r.prototype=Object.create(i),r}}function r(t){var e=1;return function(){var n=t+e;return e++,n}}function i(t){for(var e in t){var n=e.split(" "),r=n[0],i=this.shadowRoot.querySelector(n[1]),o=t[e],s=this[o]=this[o].bind(this);i.addEventListener(r,s)}}function o(t){for(var e in t)switch(e){case"exends":break;case"onCreate":break;case"onDetach":break;case"onAttributesChange":break;case"onAttach":break;case"tagName":break;case"fragment":break;case"style":break;case"events":break;default:this[e]=t[e]}}function s(){return this._currentState[this._currentState.length-1]}function a(t,e){return!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}function u(t){return t=t.replace(/[.#]/,function(t){return","+t+","}).split(",")}function c(t,e){switch(typeof e){case"function":return e.apply(this,arguments);case"string":return e}}var p={},h={},f={},l={},d=function(){function t(){function e(t){if(c===p)return void(a=t);if(c===h&&"function"==typeof t)return c=l,t.call(this,i);if(c===f)throw c=l,i}function n(t){if(c===p&&(o=t),c===h){if(i&&"function"==typeof i.then)return void i.then(d.resolve);try{i=t.call(this,i),u&&u.resolve(i)}catch(e){i=e,u&&u.reject(i)}}}function r(t){if(c===p&&(s=t),c===f)try{i=t.call(this,i),u&&u.resolve(i)}catch(e){i=e,u&&u.reject(i)}c===h&&u&&u.resolve(i)}var i,o,s,a,u,c=p,d={resolve:function(t){i=t,c=h,o?n(o):e(a)},reject:function(t){i=t,c=f,s?r(s):e(a)},then:function(e){return u=t(),n(e),{then:u.then,"catch":d["catch"],done:u.done}},"catch":function(e){return u=t(),r(e),{then:u.then,"catch":d["catch"],done:u.done}},done:function(t){e(t)}};return d}var e={},n=t();return e.resolve=n.resolve,e.reject=n.reject,e.promise={then:n.then,"catch":n["catch"],done:n.done},e},y=function(){};y.prototype.register=function(t){var e={};return function(n){var r={};return r.subscribe=function(r,i){n._subscribe(r,i,t,e)},r.publish=function(t,r,i){n._publish(t,r,i,e)},r.unsubscribe=function(r,i){n._unsubscribe(r,i,t,e)},r.unsubscribeAll=function(r){n._unsubscribeAll(r,t,e)},r}(this)},y.prototype._subscribe=function(t,e,n,r){if(r[t]||(r[t]={}),r[t][n]||(r[t][n]=[]),"function"!=typeof e)throw new Error("A callback function must be passed in to subscribe");r[t][n].push(e)},y.prototype._publish=function(t,e,n,r){function i(t,e){return function(n){n.call(this,t,e)}}e=e||null,n=n||null;var o=r[t];if(o)for(var s in o){var a=o[s];Array.isArray(a)&&a.forEach(i.call(this,e,n))}},y.prototype._unsubscribe=function(t,e,n,r){var i=r[t];if(i){var o=i[n];o.forEach(function(t,n){return t===e?void o.splice(n,1):void 0}.bind(this))}},y.prototype._unsubscribeAll=function(t,e,n){function r(t){var r=n[t];r&&r[e]&&delete r[e]}if(t)return void r(t);for(var i in n)r(i)};var v={},b=r("factory");v._constructor=function(t){this._initialize(t)},v._constructor.prototype._initialize=function(t){var n={};t=t||{},this.uuid=b(),this.resources={},this.eventBus=t.eventBus||new y,this.eventBus=this.eventBus.register(this.uuid),this.set=function(t,e){this._set(t,e,n)},this.unset=function(t){this._unset(t,n)},this.get=function(t){return this._get(t,n)},this.clone=function(){return JSON.parse(JSON.stringify(n))},"function"==typeof this.initialize&&this.initialize.apply(this,arguments),this.set(e(t,this.defaults)),this.eventBus.publish("initialize",this,t)},v._constructor.prototype._set=function(t,e,n){if("object"==typeof t&&!Array.isArray(t))for(var r in t)this._set(r,t[r],n);if("string"==typeof t){n[t]=e;var i={};i[t]=e,this.eventBus.publish("change",this,i),this.eventBus.publish("change:"+t,this,e)}},v._constructor.prototype._get=function(t,e){return"string"==typeof t?e[t]:"undefined"==typeof t?e:void 0},v._constructor.prototype._unset=function(t,e){if("string"==typeof t){var n={};n[t]=e[t],delete e[t],this.eventBus.publish("delete",this,n),this.eventBus.publish("delete:"+t,this,n[t])}else if("undefined"==typeof t)for(var r in e)this._unset(r,e)},v._constructor.prototype.sync=function(t,e){this.resources[t]=t,t.eventBus.subscribe("change:"+e,function(t,e){for(var n in e)this.set(n,e[n])}.bind(this)),t.eventBus.subscribe("delete:"+e,function(t,e){this.unset()}.bind(this))},v.extend=n;var g=r("service"),m={};m._constructor=function(t){this._initialize(t)},m._constructor.prototype._initialize=function(t){this.uuid=g(),"function"==typeof this.initialize&&this.initialize.apply(this,arguments)},m._constructor.prototype.subscribeAll=function(t,e){for(var n in e){var r=e[n],i=this[r]=this[r].bind(this);t.eventBus.subscribe(n,i)}},m.extend=n;var _=r("component"),C={},w={};w.register=function(t){if(C[t.tagName])return C[t.tagName];var e={},n=Object.create(HTMLElement.prototype);return o.call(n,t),n.createdCallback=function(){var e=this.createShadowRoot();e.appendChild(t.fragment.cloneNode(!0)),this.uuid=_(),t.style&&e.appendChild(t.style.cloneNode(!0)),t.onCreate&&t.onCreate.apply(this,arguments)},n.attachedCallback=function(){t.onAttach&&t.onAttach.apply(this,arguments),i.call(this,t.events)},n.detachedCallback=function(){t.onDetach&&t.onDetach.apply(this,arguments)},n.attributeChangedCallback=function(e,n,r){t.onAttributesChange&&t.onAttributesChange[e].apply(this,[n,r])},e.prototype=n,t["extends"]&&(e["extends"]=t["extends"]),C[t.tagName]=document.registerElement(t.tagName,e),C[t.tagName]},w.extend=function(t,e){var n=C[t],r={},s=Object.create(HTMLElement.prototype);return o.call(s,e),s.createdCallback=function(){n.prototype.createdCallback.apply(this,arguments),e.onCreate&&e.onCreate.apply(this,arguments)},s.attachedCallback=function(){n.prototype.attachedCallback.apply(this,arguments),e.onAttach&&e.onAttach.apply(this,arguments),i.call(this,e.events)},s.detachedCallback=function(){n.prototype.detachedCallback.apply(this,arguments),e.onDetach&&e.onDetach.apply(this,arguments)},s.attributeChangedCallback=function(t,r,i){n.prototype.attributeChangedCallback.apply(this,arguments),e.onAttributesChange&&e.onAttributesChange[t].apply(this,[r,i])},r.prototype=s,document.registerElement(e.tagName,r)};var x={},E={},k=function(){};k.prototype.stringify=function(t){var e="";for(var n in t){e+=n+"{";var r=t[n];for(var i in r){var o=r[i];e+=i+":"+o+";"}e=e.slice(0,e.length-1),e+="}"}return e},k.prototype.createStyleTag=function(t){var e=document.createElement("style");return t=this.stringify(t),e.innerText=t,e},k.prototype.registerMixins=function(t,e){x[t]=e},k.prototype.registerVariables=function(t,e){E[t]=e},k.prototype.getVariable=function(t){return E[t]?E[t]:void console.error("Variable "+t+" does not exist.")},k.prototype.toHex=function(t){function e(t){var e=t.toString(16);return 1==e.length?"0"+e:e}return t=t.replace(" ","").split(","),"#"+e(t[0])+e(t[1])+e(t[2])},k.prototype.toRGB=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?"rgb("+[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)].join(",")+")":null},k.prototype.toRGBa=function(t,e){var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?"rgba("+[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),e].join(",")+")":null},k.prototype.getMixins=function(t){return x[t]?x[t]:void console.error("Mixin "+t+" does not exist.")};var A={},q=function(){};q.prototype["export"]=function(t,e){if("string"!=typeof t)throw new Error("Module name is not a string.");if("function"!=typeof e)throw new Error("Module is not a function.");A[t]=function(t){t(e())}},q.prototype["import"]=function(t){function e(i,s){var a=t[i];if("string"!=typeof i)throw new Error("Module name is not a string.");if("string"!=typeof a)throw new Error("URL is not a string.");var u=A[i];if(u)s.resolve(u());else{var c=document.createElement("script");c.type="text/javascript",c.src=a,c.onload=function(){var t=d();console.log("Loading "+i+"..."),t.promise.then(function(t){o[i]=t,n++,0===r.length?s.resolve(o):e(r.pop(),s)}),c.remove(),A[i](t.resolve)}.bind(this,i),document.body.appendChild(c)}}var n=0,r=Object.keys(t),i=d(),o={};return e(r.pop(),i),i.promise.and={},i.promise.and["export"]=function(t,e){A[t]=function(n){i.promise.then(function(n){return A[t]=e.bind(this,n),e.call(this,n)}.bind(this)).done(n)}}.bind(this),i.promise.and["import"]=function(t){return i.promise.then(this["import"].bind(this,t))}.bind(this),i.promise};var B=v.extend({ajax:function(e){function n(t){return"DELETE"===e.type.toUpperCase()?Array.isArray(t)?t.forEach(function(t){this.unset(t[e.indexBy],t)}.bind(this)):"object"==typeof t&&this.unset(t[e.indexBy],t):Array.isArray(t)?t.forEach(function(t){this.set(t[e.indexBy],t)}.bind(this)):"object"==typeof t&&this.set(t[e.indexBy],t),t}function r(t){return e.parse?e.parse(t):this.parse(t)}if(!e.url)throw new Error("Url is required.");if(!e.type)throw new Error("Request type is required.");return e.contentType=e.contentType||"application/json",e.encode=e.encode||null,e.payload=e.payload||null,e.indexBy=e.indexBy||"id",t(e).then(r.bind(this)).then(n.bind(this))},parse:function(t){return JSON.parse(t)}}),j={},N=function(){};N.prototype.register=function(t){if(j[t])throw new Error("Resource "+t+" already exist.");return j[t]=new B,j[t]},N.prototype.get=function(t){return j[t]?j[t]:this.register(t)};var S=function(){};S.prototype.createTemplate=function(){return new R};var R=function(){this._currentState=[],this._queue=[],this._conditional=void 0,this._state=void 0,this._loop=void 0,this._start=void 0};R.prototype.create=function(t){t=u(t);var e=function(){var e=document.createElement(t[0]);"."===t[1]?e.className=t[2]:"#"===t[1]&&(e.id=t[2]),this._currentState.push(e)}.bind(this);return this._queue.push({type:"open",fn:e}),this},R.prototype.addClass=function(t){var e=function(e){var n=s.call(this);t=c(e,t);var r=n.className.length>0?" ":"";a(n,t)||(n.className+=r+t)}.bind(this);return this._queue.push({type:"addClass",fn:e}),this},R.prototype.text=function(t){var e=function(e){var n=s.call(this);n.textContent=c(e,t)}.bind(this);return this._queue.push({type:"text",fn:e}),this},R.prototype.attr=function(t,e){var n=function(n){var r=s.call(this);r.setAttribute(c(n,t),c(n,e))}.bind(this);return this._queue.push({type:"attr",fn:n}),this},R.prototype.style=function(t,e){var n=function(n){var r=s.call(this);r.style[c(n,t)]=c(n,e)}.bind(this);return this._queue.push({type:"style",fn:n}),this},R.prototype.removeClass=function(t){var e=function(e){var n=s.call(this);if(t=c(e,t),a(n,t)){var r=new RegExp("(\\s|^)"+t+"(\\s|$)");n.className=n.className.replace(r," ")}}.bind(this);return this._queue.push({type:"removeClass",fn:e}),this},R.prototype.append=function(){var t=function(t){var e=this._currentState.pop();if(0===this._currentState.length)this.previousFragment.appendChild(e);else{var n=s.call(this);n.appendChild(e)}}.bind(this);return this._queue.push({type:"close",fn:t}),this},R.prototype.appendLast=function(){var t=function(t){var e=this._currentState.pop();this.previousFragment.appendChild(e)}.bind(this);return this._queue.push({type:"end",fn:t}),this},R.prototype["if"]=function(t){var e=function(e){this._state="conditional",t=c(e,t),this._conditional=!!t}.bind(this);return this._queue.push({type:"if",fn:e}),this},R.prototype["else"]=function(){var t=function(t){this._conditional=!this._conditional}.bind(this);return this._queue.push({type:"else",fn:t}),this},R.prototype.each=function(t){var e=function(e,n){this._loop=c(e,t),this._state="loop",this._start=n}.bind(this);return this._queue.push({type:"each",fn:e}),this},R.prototype.done=function(){var t=function(t,e){this._conditional=void 0,this._state=void 0}.bind(this);return this._queue.push({type:"done",fn:t}),this},R.prototype.render=function(t){return this.previousFragment=document.createDocumentFragment(),this._queue.forEach(function(e,n){switch(this._state){case"conditional":(this._conditional||"else"===e.type||"done"===e.type)&&e.fn(t,n);break;case"loop":"done"===e.type&&(this._loop.forEach(function(t,e){for(var r=this._start+1;n>r;r++){var i=this._queue[r];i.fn(t,e)}}.bind(this)),e.fn(t,n));break;default:e.fn(t,n)}}.bind(this)),this.previousFragment};var T=new y,O={Factory:v,Service:m,Component:w,Vow:d,Stylizer:new k,Renderer:new S,Module:new q,Resource:new N};O.registerGlobalEventBus=function(t){return T.register(t)},module&&module.exports?module.exports=O:window.Trio=O}();